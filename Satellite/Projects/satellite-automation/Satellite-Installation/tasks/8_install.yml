- name: install | get package facts
  package_facts:
    manager: auto

- name: install | checking if services are running
  shell: satellite-maintain service status > /dev/null
  register: service
  failed_when: service.rc not in [1,0]

# copy template file with sceniario options and only run installer if changed
- name: install | copy installer script
  template:
    src: satellite_install.sh.j2
    dest: /root/satellite_install.sh
    owner: root
    group: root
    mode: 0640
  notify: run_installer
  when: service.rc == 1

- meta: flush_handlers

- name: Activation of the performance tuning
  shell: satellite-installer --tuning "{{ satellite_tuning }}"
  when: service.rc == 1
